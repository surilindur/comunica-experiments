services:
  solidpods-local:
    build:
      context: ./input/solidserver
      network: host
    container_name: solidpods-local
    environment:
      CSS_BASE_URL: http://solidpods-local
      CSS_CONFIG: /tmp/config.json
      CSS_LOGGING_LEVEL: info
      CSS_PORT: 80
      CSS_ROOT_FILE_PATH: /var/cssdata
    healthcheck:
      test: curl -I http://solidpods-local/pods/
      interval: 10s
      timeout: 1s
      retries: 3
    restart: unless-stopped
    volumes:
      - ./input/solidserver/config.json:/tmp/config.json:ro
      - ./generated/out-fragments/http/solidpods-local:/var/cssdata:ro
  www-ldbc-eu:
    build:
      context: ./input/solidserver
      network: host
    container_name: www-ldbc-eu
    environment:
      CSS_BASE_URL: http://www-ldbc-eu
      CSS_CONFIG: /tmp/config.json
      CSS_LOGGING_LEVEL: info
      CSS_PORT: 80
      CSS_ROOT_FILE_PATH: /var/cssdata
    healthcheck:
      test: curl -I http://www-ldbc-eu/tagclass/
      interval: 10s
      timeout: 1s
      retries: 3
    restart: unless-stopped
    volumes:
      - ./input/solidserver/config.json:/tmp/config.json:ro
      - ./generated/out-fragments/http/www-ldbc-eu:/var/cssdata:ro
  dbpedia-org:
    build:
      context: ./input/solidserver
      network: host
    container_name: dbpedia-org
    environment:
      CSS_BASE_URL: http://dbpedia-org
      CSS_CONFIG: /tmp/config.json
      CSS_LOGGING_LEVEL: info
      CSS_PORT: 80
      CSS_ROOT_FILE_PATH: /var/cssdata
    healthcheck:
      test: curl -I http://dbpedia-org/resource/
      interval: 10s
      timeout: 1s
      retries: 3
    restart: unless-stopped
    volumes:
      - ./input/solidserver/config.json:/tmp/config.json:ro
      - ./generated/out-fragments/http/dbpedia-org:/var/cssdata:ro
  comunica:
    build:
      context: ./input/comunica
      network: host
    command: --invalidateCache --idp void --context /tmp/context.json --port 3000 --timeout 60
    container_name: comunica
    depends_on:
      solidpods-local:
        condition: service_healthy
      www-ldbc-eu:
        condition: service_healthy
      dbpedia-org:
        condition: service_healthy
    environment:
      COMUNICA_CONFIG: /tmp/config.json
    ports:
      - 3000:3000
    restart: unless-stopped
    volumes:
      - ./input/comunica/context.json:/tmp/context.json:ro
      - ./input/comunica/config-${COMUNICA_CONFIG}.json:/tmp/config.json:ro
